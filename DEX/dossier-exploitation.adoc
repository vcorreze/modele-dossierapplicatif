////
exploitation.adoc

SPDX-FileCopyrightText: 2023 Vincent Corrèze

SPDX-License-Identifier: CC-BY-SA-4.0
////

# Dossier d'exploitation
:sectnumlevels: 4
:toclevels: 4
:sectnums: 4
:toc: left
:icons: font
:toc-title: Sommaire

*Dernière modification* : {docdate}

*Date dernière revue globale* : _<Faire régulièrement des revues globale du dossier (au moins une fois par an tant que l'application est en production) et mentionner la date ici>_

*Statut du document* : _<Donner ici le statut, par exemple 'DRAFT', 'FINALISE', etc.>_

## Introduction

### but de la documentation

Ce dossier a pour but de permettre de fournir à une équipe d'exploitants de la solution technique les procédures et informations utiles et nécessaires à son bon fonctionnement.

Les autres vues du dossier sont disponibles link:../README.adoc[ici].

Le glossaire du projet est disponible link:../glossaire.adoc[ici]. Les termes fonctionnels et techniques ne sont pas redéfinis dans ce document.

[TIP]
====
Le Dossier d'exploitation (DEX) est le document principal du fonctionnement courant d'un outil en production. Il recense et documente les éléments majeurs du fonctionnement, pour permettre une supervision, un diagnostic et une intervention réactive pour toute non-conformité constatée.
====

### Destinataires

Ce document s'adresse à l'équipe technique d'exploitation de la solution.

[TIP]
====
Indiquer ici précisément qui sont les destinataires du document. Il s'agit de recenser les profils qui doivent connaître ce document pour permettre le bon fonctionnement de l'application ou de la solution concernée, ou qui sont susceptible d'intervenir sur la solution en cas d'incident de fonctionnement.
====

## Rappels

### Information concernant les licences

[TIP]
====
Vous pouvez résumer ici les modalités exactes d'acquisition de licence, leur configuration et leur fonctionnement (licence par siège ou par serveur, modalités de comptabilisation, etc.). Les modalités d'attribution aux personnes concernées sont précisées au § <<Gestion des habilitations>>.

S'il s'agit d'une licence libre, vous pouvez indiquer les modalités d'accès au code et distinguer les licences du code et de la documentation.
====

====
Exemple 1 : La solution logicielle est soumise à licence commerciale de la part du fournisseur. Les licences sont affectées par serveur, et limitées par un nombre d'utilisateurs concurrents. 10 utilisateurs sont possibles. Il est possible de désactiver un accès ou de vérifier le nombre d'accès concurrents dans le module "gestion des accès" accessible dans la fenêtre de connexion avec un profil administrateur.
====
====
Exemple 2 : La documentation (y compris ce document) est publié sous link:https://www.etalab.gouv.fr/wp-content/uploads/2017/04/ETALAB-Licence-Ouverte-v2.0.pdf[Licence Ouverte 2.0]
====

## Documents de référence

TIP: Référencer ici les documents de référence mutualisés (ex: PSSI). Il ne faut en aucun cas reprendre leurs contenu pour ne pas devenir non maintenable. Il est important d'indiquer la version à laquelle on se réfère, afin de déclencher une actualisation du document si le document de référence est modifié.

### Documents internes

.Documents internes
[cols="1,3,1"]
|===
| Nom | Titre/URi du document | Version

| PSSI | Politique de sécurité | 2.3.0

| DA | link:../DA/[Dossier d'architecture] | 1.3.5

| DEX | Ce document | `N/A`

| DIN | link:../DIN/[Dossier d'INstallation] | #166c9d0 du XX/09/2023

| DMV | link:../DMV/[Dossier de Montée de Version] |  XX/09/2023

|===

### Référentiels externes

TIP: Si l'application dispose de référentiels externes (documentation en ligne, documentations déposées sur le SI), elles peuvent être indiquées ici, en indiquant le type de documentation.

## Présentation de l'application

### Description succincte de l'application.

TIP: Ce paragraphe a vocation à donner aux personnes de l'équipe technique une compréhension globale du rôle et du fonctionnement de l'application concernée, ainsi que de sa valeur métier.

### Lien avec les applications existantes

TIP: Si l'application est intégrée dans une chaîne de traitement, il est essentiel pour les acteurs de l'exploitation de comprendre les processus métiers bloqués par son dysfonctionnement. On insère donc ici un résumé de la chaîne de traitement global.
Utiliser éventuellement des diagrammes (type Mermaid) pour clarifier le fonctionnement.

### Gestion des habilitations

#### Procédure d'habilitation

TIP: On décrit ici les modalités de la procédure d'habilitation : processus de validation de la création de compte, modalités et délais de réalisation et procédure de revue de droits. La fréquence de la revue de droits doit être précisée. On peut utiliser par exemple un diagramme de séquence pour décrire la procédure.

#### Rôles disponibles

TIP: Ce chapitre détaille les rôles d'accès à l'application et indique quelles sont les autorités qui valident l'habilitation de chacun des rôles et réalisent les revues de droit.

## Criticité de l'application

[TIP]
====
L'étude et la qualification des déterminants de sécurité relèvent de la link:../DA/vue-architecture-securite.adoc[vue sécurité] du dossier d'architecture. Le tableau ci-dessous est une synthèse pour permettre aux exploitants une vue rapide des exigences de sécurité relative à l'application. Il a pour but de rappeler précisément le niveau de criticité de l'application à la personne qui intervient.

La notion de criticité globale est une synthèse de la criticité de l'application pour les équipes métier et le système d'information global.
====

.Tableau des déterminants de sécurité
[Cols="2,2,2,2,2"]
|===
| Composant | Valeur | Commentaire

| Criticité métier | |

| Disponibilité | |

| Intégrité | |

| Confidentialité | |

| Traçabilité | |

| Données à caractère personnel | |

|===

====
Exemple :

[Cols="2,2,2,2,2"]
|===
| Composant | Valeur | Commentaire

| Criticité métier | Critique | le bon fonctionnement de la paie est critique pour les parties prenantes de l'entreprise

| Disponibilité | 3 - Important | l'application doit être disponible sous 4H pour les équipes RH

| Intégrité | 4 - majeur | Les données doivent être conservées sans altération

| Confidentialité | 3 - Important | Les données sont à accès restreint

| Traçabilité | 3 - Important | Toute modification des données doit être tracée.

| Données à caractère personnel | DRH-1 | Les données personnelles des salariés sont présentes. Le traitement relève de la fiche DRH-1 du registre RGPD.

|===
====

## Expertise requise

[TIP]
====
Ce paragraphe sert à préciser les compétences *absolument indispensables* pour une exploitation basique de la solution.

Cela permet à une personne en charge du support de savoir si elle doit faire appel à une autre ressource (support externe, administrateur système spécialisé, etc.) ou si elle peut intervenir sur l'incident constaté.
====

Les  équipes en charge du déploiement et de l'exploitation de l'outil devront disposer des compétences suivantes :

.Compétences requises
[Cols="1,1,2,2,2,4"]
|===
|Thème | Outil | Description | Niveau Requis |Niveau de criticité | Exemple de compétence requise

| Système | | | | |

| Configuration | | | | |

| Supervision | | | | |

| Base de données | | | | |

| Applicatif | | | | |

| Stockage | | | | |

|===

L'indication fournie ici reste générale, et n'a pas vocation à faire une classification détaillée des compétences requises.

====
Exemple
[Cols="1,1,2,2,2,4"]
|===
|Thème | Outil | Description | Niveau Requis |Niveau de criticité | Exemple de compétence requise

| Système | Windows | OS | 2 - aisance | 3 - majeur | être à l'aise avec le fonctionnement d'un serveur windows

| Stockage | Disque | lecteur windows | 2/4 - aisance | 1/4 - Mineur  | Savoir archiver la base sur un lecteur

|===

====

## Description de l'environnement et configuration
[TIP]
====
Nous détaillons ici l'environnement exact de production, avec toutes ses composantes physiques, d'outils socles (CORS), de composants.

La description doit être orientée pour une description du fonctionnement courant de l'application.
====

### Présentation de l'architecture générale
TIP: on décrira ici l'architecture générale de l'application, sans rentrer dans les détails de chaque composant. l'enjeu est de lister l'ensemble des composants *boites noires* d'exploitation, pour donner à l'exploitation une idée des modules successifs, non de décrire en détail le fonctionnement de chaque module.

====
Exemple: L'application est une application trois tiers en environnement web composée des modules suivants:

- Un serveur web : nginx
- Un moteur d'exécution : php-fpm 8.0
- Un serveur de base de données : postgresql 15

L'applicatif utilise aussi des requêtes asynchrones vers l'API web de la link:https://api.gouv.fr/les-api/base-adresse-nationale[base adresse].

Le dimensionnement de l'application est construit pour que ces modules soient tous déployés sur le même serveur, une machine virtuelle.
====

### Description des serveurs
[TIP]
====
On décrira ici les serveurs utilisés par l'application, en détaillant *a minima* les serveurs de production.

Il est important de préciser s'il existe des serveurs de staging, de développement et/ou une chaine de déploiement automatique pour permettre à l'exploitant d'explorer cette piste en cas d'erreur.
====

### Matériels physiques
TIP: décrire ici les matériels physiques concernés par l'application. Il peut s'agir de serveurs mais aussi des périphériques nécessaires au fonctionnement (par exemple des badgeuses).

### Description des composants
TIP: décrire ici plus en détail les composants de l'application et leur modalités de fonctionnement.

.Composants

.Composants majeurs de l'application
[Cols="1,2,3"]
|===
| Composant | Description | type |Commentaire

| OS | | |
| Composants applicatifs | | |
| Stockage | | |

|===


====
Exemple:

[Cols="1,2,3"]
|===
| Composant | Description | type | Commentaire

| OS | linux Debian 12 | VM |
| Bases de données (stockage) | mariadb 10.5.21 | service systemd |
| Serveur web | nginx 1.18.0 | service systemd |
| Moteur de script | php8.0-fpm | service systemd | Attention, plusieurs version installées sur le serveur
| API externe | base adresse | API | Attention, accès https requis

|===
====

### Stockage des données

[TIP]
====
On détaillera ici précisément les modalités de stockage des données.
====

WARNING: Il est nécessaire de bien prendre en compte l'ensemble des données de l'application, y compris les données de configuration et les données techniques (logs par exemple, ou code source si disponible) pour donner une vision d'ensemble des données manipulées.

## Exploitation globale
Ce chapitre détaille les opérations courantes d'exploitation de l'application.

### Gestion des accès
[TIP]
====
La gestion des accès (habilitations) d'une application est l'opération la plus courante en terme d'exploitation. Ce paragraphe décrit les modalités concrète de création d'un compte et d'attribution d'un rôle.

Il est important de s'assurer :

- qu'il existe plusieurs comptes administrateurs pour pouvoir débloquer un compte administrateur verrouillé à partir d'un autre compte.
- que les modalités d'attribution d'un rôle sont bien définies, et en particulier que la chaîne de responsabilité correspondante est bien décrite (Cf. supra le chapitre sur la <<Gestion des habilitations>>.).
====

### Mise en service de l'application
[TIP]
====
Ce paragraphe doit décrire les modalités d'arrêt/démarrage de l'application. En particulier, il détail l'ordre d'arrêt/démarrage des services (plan de production), et les dépendances entre ces services.
====

.Plan de production de l'application
[cols="1e,^1,^1" grid=rows]
|===
| Service | Rang de démarrage | Rang d'arrêt

| | |

|===

====
*Exemple*: le service MariaDB **doit** démarrer avant le serveur web, car la configuration de l'application est stockée en base.
====
====
*Exemple 2*:

[cols="1e,^1,^1" grid=rows]
|===
| Service | Rang de démarrage | Rang d'arrêt

| nginx | 3 | 1
| php-fpm | 2 | 2
| mariadb | 1 | 3

|===
====

### Paramétrage et configuration
[TIP]
====
Détailler ici où trouver les informations de paramétrage de l'application. On doit indiquer à la fois où se trouve la documentation de référence du paramétrage (_ie_ le dossier de paramétrage s'il existe) et l'emplacement exact des informations de paramétrage essentielles de l'application et de ses modules.

Attention de ne pas dupliquer ici des informations standard où des règles génériques de fonctionnement déjà décrites par ailleurs.
====
====
*Exemple* : la configuration du serveur web est localisée à son emplacement standard `/etc/nginx/`.
====
====
*Exemple 2* : le dossier de configuration est localisé dans l'arborescence d'exploitation sur le serveur de fichier `FIC01` dans le répertoire `Exploitation/application01`.
====

### Déploiement / mise à jour
[TIP]
====
Ce paragraphe décrit sommairement les modalités de déploiement et de mise à jour de l'application.

Il doit pointer vers une version détaillée dans les dossiers *DIN* (Dossier d'Installation) et *DMV* (Dossier de montée de version). Si les procédures correspondante sont en lignes, les liens sont indiqués ici.
====
====
Exemple : La procédure de montée de version est précisée dans la link:https://glpi-install.readthedocs.io/fr/latest/update.html[Documentation en ligne]
====

### Interruption / Maintenance
[TIP]
====
Si l'application dispose d'une modalité de bascule en mode maintenance, elle est décrite ici.

A défaut, il faut préciser ici les modalités de mise en oeuvre d'un mode maintenance.
====
====
Exemple: Transmettre un mail à tous les utilisateurs pour les prévenir de la date et de la durée de la maintenance prévue.
====

### Sauvegarde / Restauration

#### Modalités de sauvegarde
[TIP]
====
Ce chapitre décrit en détail les éléments sauvegardés, la périodicité et les stratégies de sauvegarde ainsi que leur bilan.

Il détaille aussi bien les filesystem sauvegardés que le plan de dump de la base de donnée, et les modalités de rotation des sauvegarde.

Le choix et la définition de stratégie de link:https://fr.wikipedia.org/wiki/Sauvegarde_(informatique)[sauvegarde] sont hors du périmètre de ce document, mais il est important de respecter à minima le principe *3,2,1* (trois sauvegardes sur deux supports différents dont 1 hors site).

Il est fréquent de disposer à la fois d'un plan de sauvegarde de la donnée (p. ex dump de base), d'un plan de sauvegarde de l'application (filesystem, qui intègre les données) et d'un plan de sauvegarde de la machine. Ce principe, dit _ceinture, bretelle, parachute_ permet de s'assurer d'avoir trois modalités différentes de restauration de l'applicatif.

Afin de garantir le bon fonctionnement des sauvegardes, celles-ci doivent être *régulièrement testées* et le plan de test et ses résultats doivent être décrits ici.

La volumétrie des sauvegardes peut rapidement devenir importante. Il est important de définir une stratégie de rotation, en lien avec les aspects de sécurité ou de conformité réglementaire, permettant de limiter celle-ci. On s'intéressera par exemple à la stratégie link:https://fr.wikipedia.org/wiki/Grandfather-Father-Son_Backup[GFS] et ses variantes.

Ce paragraphe doit décrire aussi les modalités d'une sauvegarde à la demande de l'application, par exemple avant une modification importante de paramétrage ou une montée de version.

Particulièrement ici, en application du Principe link:https://fr.wikipedia.org/wiki/Ne_vous_r%C3%A9p%C3%A9tez_pas[DRY], si l'application suit un plan normalisé de sauvegarde, on ne fera ici qu'un lien vers celui-ci.
====

#### Restauration
TIP: Ce chapitre doit décrire les modalités standard de restauration (_ie_ même si vous avez plusieurs modalités de restauration, indiquer la modalité préférentielle et ses contraintes).

====
Exemple : Avant toute restauration il est nécessaire d'obtenir l'aval du responsable d'application et de coordonner avec lui l'arrêt de production correspondant.

La restauration s'effectue par relecture du dump de base avec la commmande `mysql < yyyymmdd-dumpbaseappli.sql`.
====

### Exploitation des composants standard (COTS) de l'application
[TIP]
====
On détaillera ici les modalités particulière d'exploitation des composants sur étagère.

En particulier, si leur fonctionnement nécessite des commandes ou un paramétrage complexes, elles sont détaillées dans ce chapitre.
====
====
Exemple: la configuration de _nginx_ se trouve dans le répertoire standard `/etc/nginx`. Elle est conforme à l'usage défini par https://nginxconfig.io/ pour mutualiser la configuration.
====

### Exploitation des composants de l'application
TIP: si des composants particuliers de l'application nécessitent une configuration ou une gestion particulière, elle est explicitée ici.

====
Exemple: le script `cron` de gestion des notifications est paramétré via un lien symbolique dans le répertoire `/etc/cron.d/`
====

====
Exemple 2 : Le module talend de transfert des fichiers accède au répertoire local `C:\Interface\Transferts\Emission` et au répertoire distant `$Server\d$\Transfert\Reception`
====

### Planification des traitements
[TIP]
====
Ce paragraphe doit détailler le plan chronologique des traitements effectués par l'application. Il est important pour déterminer les périodes d'intervention possible sur l'application.

Il est particulièrement sensible si des traitements manipulent ou transfèrent des données métier et ont un temps d'exécution significatif. Il doit permettre d'identifier les phases critiques de fonctionnement.

Il est nécessaire que l'ensemble des traitements, leur horaire et leur durée moyenne ainsi que les moyens de suivi soient détaillés. Il faut aller dans le détail de la planification.
====

.Planification des traitements
[cols="1e,^1,2,2,2,4a"]
|===
| Nom | Horaire | Objet | modalités | durée | contrôle

| | | | | |

|===

====
Exemple:
[cols="1e,^1,2,2,2,4a"]
|===
| Nom | Horaire | Objet | modalités | durée | contrôle

| Sauvegarde | 05:05 | Sauvegarde | mysqldump exécuté via `cron` | 1h | contrôler les processus actifs pour vérifier si le traitement est terminé.

| NormAdress | toute les heures | Normalisation des adresses | via `cron` | *45mn* | `/bin/php /opt/app/NormAdress status`

|===
====

### Echanges de données
Ce chapitre décrit les différentes interfaces de données effectuées par l'application.

[TIP]
====
Le fonctionnement et la gestion des interfaces de données peut revêtir un caractère critique dans le fonctionnement global d'un système d'information. L'exploitation doit connaître les modalités de transfert des données pour pouvoir diagnostiquer les erreurs éventuelles.
====

#### Données entrantes
====
Exemple : Les données de badgeage sont transmises à l'application par dépôt dans le répertoire `BADGEAGE$` sur le serveur.

Ce répertoire doit être accessible en lecture/écriture au compte de service `Svc.UserBadge`.
====

#### Données sortantes
====
Exemple: Les données d'éléments variable de paie sont transférées sur le serveur de paie via un module Talend qui assure la copie et l'archivage des fichiers evp émis par l'application de badgeage.

Ce script est exécuté toutes les minutes de telle sorte que les fichiers d'evp ne soient jamais écrasés par les suivants.
====

#### Exports
[TIP]
====
Les exports de données sont souvent des fonctions très utilisées, et mal définies. Les exports sont souvent utiliser pour retraiter ces données pour d'autres fonctions métier.

Ces exports contiennent souvent des données sensibles (données personnelles par exemple) et doivent donc bénéficier d'une attention particulière en terme de diffusion, de sauvegarde et de confidentialité.

Il faut décrire ici les types d'export sensibles et les modalités de sécurité qui s'y rapportent.
====

## Suivi de l'état du système
Ce chapitre décrit l'ensemble des éléments et méthodes techniques de suivi de l'état du système.

### Veille et patchs
[TIP]
====
Il faut indiquer ici les éléments de veille de sécurité sur l'outil, et les modalités de suivi des patchs et mises à jour de sécurité. On précisera en particulier la fréquence minimale de suivi des mises à jour, et les conditions au regard desquelles ces mises à jour peuvent être retardées.

Ce paragraphe doit aussi décrire les modalités de test et de validation des mises à jour (non-régression, complétude du périmètre fonctionnel).
====

====
Exemple : Les mises à jour sont suivies par un module interne de l'application qui prévient les rôles administrateur de l'existence d'une nouvelle version. Le plan de test est disponible dans le dossier DT et doit être validé sur l'environnement de pré-production avant bascule en production.
====

### api de supervision
TIP: Si l'application dispose d'une api de supervision, elles est détaillées ici.

====
Exemple : `nginx` dispose d'un module de statut qui a été activé. Il est visible à l'url `$hostname/nginx_status`.
====

### logs

[TIP]
====
Il est nécessaire de décrire de façon exhaustive les logs générés par l'application, tant au plan technique qu'applicatif. On indiquera à chaque fois la nature et l'objet des logs générés, ainsi que leur emplacement.
====

.Logs générés par l'application
[cols="1,1,2a"]
|===
| Nom | Localisation | Objet

|===
====
Exemple :
[cols="1,1,2a"]
|===
| Nom | Localisation | Objet

| Syslog | `/var/log/syslog` | Enregistrement technique des opérations effectuées

| mail.log | `/var/log/mail.log` | Enregistrement spécifique des envois de mail, avec la description des modules postfix concernés.

|===

====

### audit
[TIP]
====
Certaines applications disposent de modalités spécifiques d'audit permettant de vérifier le bon fonctionnement de l'ensemble des composants.

Si ces éléments existent, il faut les décrire ici.
====

====
Exemple : Le contrôle de la configuration de `nginx` se fait via la commande `nginx -t`. Le statut du démon est visible via `systemctl status nginx`.
====
### gestion de la capacité
[TIP]
====
La vue dimensionnement du dossier d'architecture a permis d'étudier les questions de capacité de l'application.

Ce chapitre doit indiquer les points de contrôle de la capacité et l'emplacement où ils sont supervisés.
====

====
Exemple: L'outil de supervision dispose d'un capteur contrôlant l'espace disque du dossier `/var/` du serveur où est implantée le stockage de données de l'application.
====

### suivi de l'état de sécurité
[TIP]
====
Ce chapitre indique, ou pointe vers l'endroit où se trouve les informations de suivi de l'état de sécurité de l'application.

Ce suivi vise à vérifier que les contrôles de sécurité sont effectués et supervisés. S'il existe des tests de sécurité, ils doivent aussi être décrits.

Ce chapitre peut pointer vers un document global de suivi de sécurité s'il existe.
====

.Contrôles de sécurité
[cols="1,^1,1"]
|===
| Contrôle | Fréquence | dernière opération

| Revue de droits | |
| Controle de patch/version | |
| Tests d'intrusion | |

|===

====
Exemple :
[cols="1,^1,1"]
|===
| Contrôle | Fréquence | dernière opération

| Revue de droits | Trimestrielle | 2023-09-15
| Contrôle de patch/version | Mensuelle | 2023-10-19
| Tests d'intrusion | Annuelle | 2023-02-19

|===

====

### alerting
[TIP]
====
Lorsqu'il existe des modalités spécifiques d'alerting relatives à l'application (par ex. envoi d'un mail vers une BAL spécifique), celles-ci doivent être précisées.

On privilégiera bien sûr l'usage d'un outil de supervision pour assurer un alerting centralisé.

Il est important de différencier l'alerting technique (_ie_ un module ne fonctionne pas) de l'alerting métier (_ie_ la fonction de transfert des données n'a pas fonctionné.)
====

## Organisation du support
### Procédure
[TIP]
====
Ce chapitre doit décrire la procédure de support pour les intervenants décrits au § <<Destinataires>>. Il s'agit de préciser à l'exploitant les modalités d'accès au support niveau 2, voire trois. On ne détaillera pas ici la procédure de support pour les utilisateurs finaux de l'application.

Cette procédure doit indiquer les link:https://fr.wikipedia.org/wiki/Service-level_agreement[SLA] de l'application, et les modalités éventuelle d'alerte auprès des responsables applicatifs ou/et de mobilisation d'une cellule de crise.
====

### Responsable applicatif
[TIP]
====
Le ou les responsables applicatifs sont les personnes référentes habilitées à prendre des décisions opérationnelles sur le fonctionnement de l'application (arrêt, reprise de données, travail de saisie pour reprise après panne, etc.). Ils sont les interlocuteurs de la DSI pour tout ce qui concerne l'application, et doivent être explicitement désignés à cet effet.
====

.Responsables applicatifs
[cols="1,1,1,1"]
|===
| Nom | Fonction | courriel | téléphone
|===

### Rôles et attribution des intervenants
[TIP]
====
Tous les intervenants susceptibles d'intervenir, en niveau 2 ou 3, sur l'exploitation de la solution doivent être identifiés. Il peut s'agit d'un portail de support, d'adresse générique, de personnes identifiées.

Ce chapitre est souvent le plus utilisé dans le DEX, car il permet à un exploitant de savoir à qui s'adresser s'il n'a pas les ressources pour intervenir lui-même.

Il est fortement recommandé que les intervenants externes (support éditeur p. ex) soient tous identifiés dans cette partie.
====

.Intervenants support
[cols="1,1,1,2"]
|===
| Nom | courriel ou URi | téléphone | Rôle
|===

## FAQ
