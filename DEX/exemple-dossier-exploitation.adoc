////
exemple-dossier-exploitation.adoc

SPDX-FileCopyrightText: 2023 Vincent Corrèze

SPDX-License-Identifier: CC-BY-SA-4.0
////

# Dossier d'exploitation
:sectnumlevels: 4
:toclevels: 4
:sectnums: 4
:toc: left
:icons: font
:toc-title: Sommaire

*Dernière modification* : {docdate}

*Date dernière revue globale* : 2025-07-08

*Statut du document* : FINALISE

*Diffusion* : *TLP:GREEN*

## Introduction

### but de la documentation

Ce dossier a pour but de permettre de fournir à une équipe d'exploitants de la solution technique *Ishtar* les procédures et informations utiles et nécessaires à son bon fonctionnement.

NOTE: Ishtar est une application fictive !

Les autres vues du dossier sont disponibles link:../README.adoc[ici].

Le glossaire du projet est disponible link:../glossaire.adoc[ici]. Les termes fonctionnels et techniques ne sont pas redéfinis dans ce document.

### Destinataires

Ce document s'adresse à l'équipe technique d'exploitation de la solution.

Seuls les membres de l'équipe production ont accès à l'administration de l'outil.

#### Information concernant les licences

L'outil est une application développée en interne et soumise à la licence publique de l'Union européenne version 1.2 (link:https://joinup.ec.europa.eu/collection/eupl/eupl-text-eupl-12[EUPL-1.2])

Les modalités d'accès des personnes concernées sont précisées au § <<Gestion des habilitations>>.

## Documents de référence

### Documents internes

.Documents internes
[cols="1,3,1"]
|===
| Nom | Titre/URi du document | Version

| Plan de sauvegarde | Dossier H2040 | 3.2.0

| DA | link:../DA/[Dossier d'architecture] | 1.3.5

| DEX | Ce document | `N/A`

| DIN | link:../DIN/[Dossier d'INstallation] | #166c9d0 du XX/09/2023

| DMV | link:../DMV/[Dossier de Montée de Version] |  XX/09/2023

|===

### Référentiels externes

[cols="1,3,1"]
|===
| Nom | Titre/URi du document | Version

| PSSI-MCAS | link:https://www.legifrance.gouv.fr/jorf/id/JORFTEXT000031386468[Politique de sécurité] | AFSZ1523362A - 1er octobre 2015

|===

## Présentation de l'application

### Description succincte de l'application

L'application est une application 3 tiers au format LEMP permettant de gérer le processus métier de l'équipe HRDS.

### Lien avec les applications existantes

L'application n'a pas de connexion externe.

### Gestion des habilitations

On décrit ici les modalités d'autorisation d'accès à l'application. la procédure opérationnelle de création d'une compte est décrite au § <<Gestion des accès>>.

#### Rôles disponibles

L'application contient 2 rôles : administrateur et utilisateur.

#### Procédure d'habilitation

Les rôles administrateur sont réservés au responsable applicatif et à l'administrateur SI.

L'attribution d'un role utilisateur est validé par le responsable applicatif.

#### Revue de droits

La revue de droits est organisée lors des points de suivi de l'application de façon trimestrielle.

La date de dernière revue de droits est indiquée au § <<Contrôles de sécurité>>

## Criticité de l'application

.Tableau des déterminants de sécurité
[Cols="2,2,2,2,2"]
|===
| Composant | Valeur | Commentaire

| Criticité métier | 2 - Modéré | Risque organisationnel : Les saisies non effectuées doivent être reprises. Cela retarde l'action du service

| Disponibilité | 2 -Modéré | Une journée d'indisponibilité est absorbable

| Intégrité | 3 - élevé | Il faut détecter les modifications de données

| Confidentialité | 1 - faible | L'application contient des données interne

| Traçabilité | 3 - élevé | Les modifications doivent être tracées.

| Données à caractère personnel | 2 - faible | traitement n°45. L'outil contient des DCP non sensible (contacts dans les entreprises)

|===

## Expertise requise

Les  équipes en charge du déploiement et de l'exploitation de l'outil devront disposer des compétences suivantes :

.Compétences requises
[Cols="1,1,2,2,2,4"]
|===
|Thème | Outil | Description | Niveau Requis |Niveau de criticité | Exemple de compétence requise

| Système | Linux | OS | 2 - modéré | faible | accéder à l'outil

| Base de données | MariaDB | SGBD | 3 - moyen | important | gérer la sauvegarde

|===

L'indication fournie ici reste générale, et n'a pas vocation à faire une classification détaillée des compétences requises.

## Description de l'environnement et configuration

### Présentation de l'architecture générale

L'application est une application trois tiers en environnement web composée des modules suivants:

- Un serveur web : nginx
- Un moteur d'exécution : php-fpm 8.0
- Un serveur de base de données : PostgreSQL 15

L'applicatif utilise aussi des requêtes asynchrones vers l'API web de la link:https://api.gouv.fr/les-api/base-adresse-nationale[base adresse].

Le dimensionnement de l'application est construit pour que ces modules soient tous déployés sur le même serveur, une machine virtuelle.

### Description des serveurs

L'outil est installé sur le serveur PROD24. L'environnement de test est disponible sur le même serveur sur l'url https://test-ishtar.prod24.mondomaine.fr

### Matériels physiques

L'application n'a pas de matériel physique relié

### Description des composants

.Composants

.Composants majeurs de l'application
[Cols="1,2,3"]
|===
| Composant | Description | type | Commentaire

| OS | Linux Debian 12 | VM |
| Bases de données (stockage) | MariaDB 10.5.21 | service systemd |
| Serveur web | nginx 1.18.0 | service systemd |
| Moteur de script | php8.0-fpm | service systemd | Attention, plusieurs version installées sur le serveur
| API externe | base adresse | API | Attention, accès https requis

|===

### Stockage des données

TIP: Donner les modalités de stockage.

WARNING: Bien prendre en compte données + configuration + données techniques

Les données de l'application sont stockées dans MariaDB dans la base `ishtar` et la base `ishtar-test`.

La configuration des composants est dans les répertoires standard Debian sous `/etc`. Les logs d'accès sont standard.

## Exploitation globale

Ce chapitre détaille les opérations courantes d'exploitation de l'application.

### Gestion des accès

La création d'un compte se fait par activation du profil utilisateur dans le module "gestion des utilisateurs". Dans la liste des utilisateurs AD reliés à l'application, sélectionner la personne souhaitée et lui donner le profil `utilisateur` au lieu du profil `aucun accès`

### Mise en service de l'application

Les modules sont activés via `systemd`

.Plan de production de l'application
[cols="1e,^1,^1" grid=rows]
|===
| Service | Rang de démarrage | Rang d'arrêt

| nginx | 3 | 1
| php-fpm | 2 | 2
| MariaDB | 1 | 3

|===

### Paramétrage et configuration

la configuration du serveur web est localisée à son emplacement standard `/etc/nginx/`. La configuration nginx est conforme à celle proposée par https://nginxconfig.io sur la mutualisation des configurations.

le dossier de configuration est localisé dans l'arborescence d'exploitation sur le serveur de fichier `FIC01` dans le répertoire `Exploitation/application01`.

### Déploiement / mise à jour

Les mises à jour sont faites par fetch du code depuis le serveur GitLab. Elles sont poussées automatiquement par un `GitLab-runner` à chaque commit sur la branche `main`.

Le détail opérationnel est spécifié dans le DMV.

### Interruption / maintenance

Le mode maintenance est activé par la désactivation du serveur nginx.

Transmettre un mail à tous les utilisateurs pour les prévenir de la date et de la durée de la maintenance prévue.

### Sauvegarde / Restauration

#### Modalités de sauvegarde

Le plan de sauvegarde suivi est le plan standard indiqué dans le § <<Documents internes>>

Une sauvegarde à la demande peut être opérée par `mysqldump ishtar >> ($date +"\%Y-\%m-\%d")-ishtar.sql`

#### Restauration

Avant toute restauration il est nécessaire d'obtenir l'aval du responsable d'application et de coordonner avec lui l'arrêt de production correspondant.

La restauration préférentielle de l'application est une restauration de la basse sql : `mysql < yyyymmdd-ishtar.sql`

### Exploitation des composants standard (COTS) de l'application

Les CORS sont exploités de façon standard.

la configuration de _nginx_ se trouve dans le répertoire standard `/etc/nginx`.

### Exploitation des composants de l'application

Le script `cron` de gestion des notifications est paramétré via un lien symbolique dans le répertoire `/etc/cron.d/`

### Planification des traitements

.Planification des traitements
[cols="1e,^1,2,2,2,4a"]
|===
| Nom | Horaire | Objet | modalités | durée | contrôle

| NormAddress | toute les 4 heures | Normalisation des adresses | via `cron` | *45mn* | `/bin/php /opt/app/NormAddress status`

| Envois | 05:15 | Envoi des éléments aux entreprises | cron.d | 00:30 | Un mail de réussite est transmis au responsable applicatif.

| Sauvegarde | 06:00 | Sauvegarde | automysqlbackup | 00:05 | syslog.

|===

### Échanges de données
Ce chapitre décrit les différentes interfaces de données effectuées par l'application.

#### Données entrantes

L'application se connecte à la link:https://api.gouv.fr/les-api/base-adresse-nationale[base adresse] via son API.

Les données des entreprises sont transmises à l'application par dépôt dans le répertoire `bilan$` sur le serveur. Ce répertoire doit être accessible en lecture/écriture au compte de service `Svc.UserBilan`.

#### Données sortantes

Aucune interface sortante.

#### Exports

Les données peuvent être exportées au format csv. Les utilisateurs sont formés à la sécurité de ces exports.

## Suivi de l'état du système

Ce chapitre décrit l'ensemble des éléments et méthodes techniques de suivi de l'état du système.

### Veille et patchs

Les patchs sont transmis par l'équipe de développement via GitLab.

### API de supervision

L'application n'a pas d'API de supervision. Le serveur `nginx` dispose d'un module de statut qui a été activé. Il est visible à l'url `$hostname/nginx_status`.

### Logs

.Logs générés par l'application
[cols="1,1,2a"]
|===
| Nom | Localisation | Objet

| Logs de connexion nginx | `/var/log/nginx/` | logs de connexion

| Logs d'envoi des mails | `/var/www/ishtar/logs` | logs d'envoi. Attention, ils contiennent des DCP.

| Syslog | `/var/log/syslog` | Enregistrement technique des opérations effectuées. Contient des DCP.

| mail.log | `/var/log/mail.log` | Enregistrement spécifique des envois de mail, avec la description des modules postfix concernés. Contient des DCP.

|===

### Audit

Le contrôle de la configuration de `nginx` se fait via la commande `nginx -t`. Le statut du démon est visible via `systemctl status nginx`.

### Gestion de la capacité

L'outil de supervision dispose d'un capteur contrôlant l'espace disque du dossier `/var/` du serveur où est implantée le stockage de données de l'application.

### Contrôles de sécurité

.Contrôles de sécurité
[cols="1,^1,1"]
|===
| Contrôle | Fréquence | dernière opération

| Revue de droits | Trimestrielle | 2023-09-15
| Contrôle de patch/version | Mensuelle | 2023-10-19
| Tests d'intrusion | Annuelle | 2023-02-19

|===

### Alerting

L'alerting technique est assuré par le serveur de supervision.

L'alerting métier est assuré par le mail de confirmation d'envoi.

## Organisation du support

### Procédure

Le support standard est assuré via l'outil de ticketing.

En cas d'alerte technique c'est la procédure de l'équipe d'administration qui prends le relais.

En cas d'indisponibilité ou d'alerte métier sans résolution sous 1 jour, une cellule de crise est construite avec l'administrateur et l'équipe développement.

### Responsable applicatif

.Responsables applicatifs
[cols="1,1,1,1"]
|===
| Nom | Fonction | courriel | téléphone

| Julie Julejule | Responsable de département | j.julejule@monentreprise.fr | 80 17
|===

### Rôles et attribution des intervenants

.Intervenants support
[cols="1,1,1,2"]
|===
| Nom | courriel ou URi | téléphone | Rôle

| Nathalie SysSys | n.syssys@monentreprise.fr | 8080 | Administrateur système

| Jacques DevDev | j.devdev@monentreprise.fr | 8019 | Resp. équipe développement

| Entreprise WebFix | contact@webfix.fr | 02.00.00.00.00 | Support de niveau 3, a participé au développement

|===

### Modalités d'intervention distante

Pas d'intervention distante prévue.

## FAQ

Le fonctionnement de la sauvegarde à froid mensuelle de l'infrastructure fige l'applicatif qui ne redémarre pas correctement. Une intervention manuelle est nécessaire pour remettre en fonctionnement l'outil.
